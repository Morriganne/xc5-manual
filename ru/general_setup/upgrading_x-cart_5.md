---
lang: ru
layout: article_with_sidebar
updated_at: '2017-10-23 11:42 +0400'
identifier: ref_sn9tuAyV
title: Обновление X-Cart 5
order: 60
published: false
---
## Введение

В этой статье вы найдете общею информацию об обновлению X-Cart и решению возможных проблем

## Содержание

*   [Обновление на новую версию (апгрейд) и обновление текущей версии](#upgrades_and_updates)
*   [Волны апгрейда](#upgrade-waves) 
*   [Доступность обновления для разных версий](#availability-of-upgrades-for-different-versions)
*   [Специальные средства апгрейда (хуки)](#upgrade-hooks)
*   [До апгрейда: сохранение бэкапа магазина](#before-you-upgrade-back-up-your-store)
*   [Процесс апгрейда](#store-upgrade-process)
*   [Апгрейд вручную](#manual-upgrade)

## Обновление на новую версию (апгрейд) и обновление текущей версии

Обозначение версии X-Cart включает [4 числовых элемента](http://devs.x-cart.com/en/misc/x-cart_versions.html#x-cart-53x-versioning): два первых числа обозначают мажорную версию, третье число обозначает минорную версию, четвертое - версию билда (версии, в которой из нового - только исправленные баги). В соответствие с таким обозначением версий, процесс апгрейда имеет два вида:

   * **мажорный апгрейд** - апгрейд, в результате которого изменяются первые три числа в версии (номера мажорной и минорной версий), например, апгрейд с 5.0.13 на 5.1.3, с 5.2.16 на 5.2.20 или с 5.3.1.6 на 5.3.2.0.

   * **минорный апгрейд** - апгрейд, в результате которого изменяется четвертое числе в версии (версия билда), например, обновление с  5.3.1.3 на 5.3.1.6.

Тип апгрейда отражает существенность привносимых им изменений. Мажорный апгрейд дает новую функциональность и решает баги предыдущих версий. Минорный апгрейд только решает баги предыдущих версий. Новая функциональность обеспечивается мажорным апгрейдом за счет изменений ядра, то есть изменения интерфейса классов и подписей методов. Такие изменения не входят в минорный апгрейд. Как следствие, после минорного апгрейда не требуется обновления модулей, а после мажорного - модули требуют аналогичного апгрейда, чтобы быть совместимыми с новой версией ядра.

<table class="ui celled padded compact small table">
  <thead>
  	<tr>
      <th><strong>Повышение 4-го числа<br/>5.3.0.3 - 5.3.0.5</strong></th>
      <th><strong>Повышение 3-го числа<br/>5.3.0.3 - 5.3.1.0</strong></th>
      <th><strong>Повышение 2-го числа<br/>5.3.0.3 - 5.4.0.0</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Только багфиксы</td>
      <td>Багфиксы<br/>Новая функциональность<br/>Незначительные изменения API</td>
      <td>Багфиксы<br/>Новая функциональность<br/>Значительные изменения API</td>
    </tr>
    <tr>
      <td>В свободном доступе</td>
      <td>Бесплатно при наличии<br/>подписки на апгрейд</td>
      <td>Бесплатно при наличии<br/>подписки на апгрейд</td>
    </tr>
  </tbody>
</table>

Если для магазина одновременно доступны мажорный и минорный апгрейды, администратор может выбрать, какой из них осуществить. В результате минорного апгрейда, магазин  получит все багфиксы новейшего багфиксного релиза внутри ветки, в которую входит версия магазина. В результате мажорного апгрейда, магазин будет обновлен до новейшей версии и получит все новые функции и багфиксы, доступные для данного типа лицензии X-Cart. 

## Волны апгрейда

Новая версия X-Cart становится доступна существующим пользователям в два этапа.  Такой подход обеспечивает более тщательное тестирование новой версии. 

Первый этап - так называемая, **девелоперская волна**, когда сразу после анонса новой версии доступ к ней получают разработчики и первопроходцы X-Cart. На этом этапе сторонние разработчики модулей могут адаптировать свои модули к новому ядру X-Cart, а технически подкованные пользователи, могут попробовать сделать апгрейд.

Второй этап - **клиентская волна**, доступ к новой версии выдается всем владельцам магазинов в через 2-7 дней после официального релиза.

Девелоперская волна, конечно, дает новую версию раньше всех, но апгрейд рекомендуется только тем пользователям, которые уверены, что смогут справиться с возможными проблемами во время обновления. 

По умолчанию, все новые установки X-Cart настроены обновляться во время второй волны. Но если вам нужен доступ к новым версиям во время девелоперской волны, уровень доступа к обновлениям нужно изменить на **"Девелопер"**.

## Доступность обновления для разных версий

Мажорный апгрейд, изменяющий второе число в номере версии, можно сделать только с последней версии ветки. Другими словами, если ветка 5.0.x состоит из версий 5.0.10, 5.0.11, 5.0.12, 5.0.13 и 5.0.14, то единственная версия, с которой можно перейти на 5.1  - это 5.0.14. на мажорные апгрейды, которые изменяют третье число в номере версии, данное правило не распространяется, то есть магазин версии 5.0.10 можно обновить до версии 5.0.14 в один шаг. Апгрейд магазина с версии 5.0.10 до версии 5.1.0 включает два шага - апгрейд с 5.0.10 до 5.0.14 и апгрейд 5.0.14 до 5.1.0.

## Специальные средства апгрейда (хуки)

Суть любого апгрейда/обновления - всего лишь переписать текущие файлы ядра/модуля. Но бывает, что X-Cart должен выполнить синхронизацию или коммуникативную работу. Такая работа выполняется специальными средствами апгрейда (хуками). Их делят на три типа:

*   **До апгрейда:** до перезаписи файлов, работают с кодом старого ядра.
*   **После апгрейда:** после перезаписи файлов, но до перестройки кеша. Назначение -  подготовить магазин к перестройке кеша. Работают с кодом старого ядра.
*   **После восстановления:** сразу после самой первой перестройки кеша. Работают с кодом нового ядра.

Хуки ядра находятся в файле `<X-Cart 5>/upgrade/`. Например, хуки для версии 5.1.3 можно найти в папке `<X-Cart 5>/upgrade/5.1/3/`. Здесь вы найдете три типа файлов:

*   **pre_upgrade.php** содержит предапгрейдные хуки;
*   **post_upgrade.php ** содержит постапгрейдные хуки;
*   **post_rebuild.php** содержит поствосстановительные хуки.

Апгрейдные хуки действуют и в модулях, когда модулю нужно синхронизировать данные между своими версиями. Апгрейдные хуки модулей находятся в папках `<X-Cart 5>/classes/Module/<DEV-ID>/<MODULE-ID>/upgrade/`, например, `<X-Cart 5>/classes/XLite/Module/XC/ProductComparison/upgrade/`.

## До апгрейда: сохранение бэкапа магазина

Апгрейд магазина - это сложный процесс, требующий тщательной подготовки. Как минимум, необходимо сделать резервную копию магазина (файлов и базы данных). 

Также, лучше сделать тестовую копию магазина и устанавливать апгрейд и обновления на эту копию. Только если апгрейд устанавливается без проблем и тестовый магазин продолжает нормально функционировать, можно установить апгрейд и на живой магазин. 

Информацию о создании тестовой копии магазина и восстановлении резервной копии можно найти в статье {% link 'Перенос X-Cart на другое местоположение' ref_yVLJrToe %}. 

## Процесс апгрейда

Каждый магазин X-Cart один раз в день проверяет наличие обновлений в маркетплейсе. Ответ от маркета кешируется на сутки. Чтобы удалить эти закешированные данные пройдите по ссылке `admin.php?target=addons_list_marketplace&action=clear_cache`.  

Если появились обновления, в зоне администратора вы увидите надпись "Доступны обновления":

![1_updates_available.png]({{site.baseurl}}/attachments/ref_9raTXZPN/1_updates_available.png)

Также, уведомление об бновлениях появится на иконке новостей (колокольчик):

![1_updates_available1.png]({{site.baseurl}}/attachments/ref_9raTXZPN/1_updates_available1.png)

Цвет надписи "Доступны обновления" может быть оранжевым или зеленым. Оранжевый цвет сообщает о выходе версии с новыми функциями. Зеленый текст сигнализирует о выходе багфиксной версии или версии, в которой есть и новые функции, и новые багфиксы. 

![xc5_upgrades_green_available.png]({{site.baseurl}}/attachments/ref_pQQ1CLe1/xc5_upgrades_green_available.png)

Для просмотра доступных обновлений нажмите на ссылку "Доступны обновления", откроется страница "Обновления для вашей версии":

![2_4yourversion0.png]({{site.baseurl}}/attachments/ref_9raTXZPN/2_4yourversion0.png)

Вкладки на странице:: 

   *   Вкладка **Минорный апгрейд** показывает багфиксные релизы ядра и модулей:
   
   ![xc5_upgrades_minor.png]({{site.baseurl}}/attachments/ref_pQQ1CLe1/xc5_upgrades_minor.png)
      
       
   *   Вкладка **Мажорный апгрейд** показывает новые версии ядра и модулей с новыми функциями:
   ![xc5_upgrades_major.png]({{site.baseurl}}/attachments/ref_pQQ1CLe1/xc5_upgrades_major.png)

Ссылка **Дополнительные опции** позволяет устанавливать обновления выборочно:

![xc5_upgrades_advanced_mode.png]({{site.baseurl}}/attachments/ref_9raTXZPN/xc5_upgrades_advanced_mode.png)

**Следуйте данным инструкциям по апгрейду магазина:**

   1.  Создайте резервную копию магазина (файлов и базы данных). Бэкап необходим на случай сбоя обновления.  Не пропускайте данный шаг, т.к. это может стоить вам часов переговоров с хостинг провайдером и восстановления магазина из серверного бэкапа.

   2.  В зоне администратора магазина пройдите по ссылке **"Доступны обновления"** на страницу **"Обновления для вашей версии"**.

   3.  Проверьте доступные обновления и выберите те, которые хотите установить. Если доступны оба апгрейда - мажорный и минорный - перейдите на соответствующую вкладку:
       *   Чтобы установить только багфиксы, перейдите на вкладку **минорного апгрейда**. 
       *   Чтобы установить багфиксы и обновить функциональность, перейдите на вкладку **мажорного апгрейда**. 
       
       Если вы не желаете делать полный апгрейд магазина с установкой всех доступных обновлений, перейдите по ссылке **"Дополнительные опции"** и выберите только те обновления, которые нужно установить.  
       ![xc5_upgrades_advanced_mode.png]({{site.baseurl}}/attachments/ref_9raTXZPN/xc5_upgrades_advanced_mode.png)

       Обратите внимание, что после неполного обновления возможны сбои в работе магазина. Неполный апгрейд рекомендуется делать в крайних случаях, и только если вы уверены, чт сможете справиться с возможными последсвиями. 
       
   4.  Выбрав обновления, в конце списка нажмите **"Установить обновления"**.
   
       ![3_install_updates.png]({{site.baseurl}}/attachments/ref_9raTXZPN/3_install_updates.png)

   5.  Откроется страница, на котрой нужно будет подтвердить начало обновления. Здесь вы увидите список компонентов для обновления, их текущую и целевую версии:
   
       ![4_components1.png]({{site.baseurl}}/attachments/ref_9raTXZPN/4_components1.png)

       Если все верно, нажмите **"Продолжить"** для запуска обновления:
       
       ![4_components2.png]({{site.baseurl}}/attachments/ref_9raTXZPN/4_components2.png)

       Обновления доступны только для магазинов с активированной лицензией. Если у вас тестовый магазин и никакая лицензия (бесплатная или платная) для него не активирована, вы не сможете пройти дальше этого шага, вы увидите предупреждение о лицензионной проблеме:
       
       ![4_licensekey.png]({{site.baseurl}}/attachments/ref_9raTXZPN/4_licensekey.png)
       
       В этом случае, нужно, по крайней мере, активировать бесплатную лицензию или купить и активировать платную. После активации лицензии на странице обновления появится кнопка **"Продолжить"**.
    
   6.  Как только вы нажмете **"Продолжить"**, будут скачаны обновления ядра и модулей:   
        ![5_downl.png]({{site.baseurl}}/attachments/ref_9raTXZPN/5_downl.png)
       
        Скачанные обновления будут распакованы:
        ![6_unpacking.png]({{site.baseurl}}/attachments/ref_9raTXZPN/6_unpacking.png)
       
        ...и проверены на целостность:       
        ![7_checking_integrity.png]({{site.baseurl}}/attachments/ref_9raTXZPN/7_checking_integrity.png)

        Важно: если этот шаг не выполнен по причине плохого Интернет соединения, измените значение `REQUEST_LONG_TTL` в скрипте  `<X-Cart 5>/var/run/classes/XLite/Core/Marketplace.php`.

   7.  На странице появится список загруженных обновлений. Также, здесь нужно подтвердить создание резервной копии магазина. 
   
   


   